# Reliability E2E 用例 

| 用例编号   | 标题                                                                                                                                                                                                                                                                                                                                                                                                                                             | 优先级 | 冒烟    | 状态   | 其他 |
|--------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----|-------|------|----|
| R00001 | 使用 `kwok` 创建 10 个 `Node`，创建 1000 个副本的 `Deployment`，创建 `Policy` 并设置 `PodSelector`，使之与 `Deployment` 匹配，<br/> 真实节点中匹配到的所有 `Pod` 的出口 IP 为 `eip`                                                                                                                                                                                                                                                                                                    | p3  | false |  |    |
| R00002 | 使用 `kwok` 创建 10 个 `Node`，创建 1000 个副本的 `Deployment`，创建 `Policy` 并设置 `PodSelector`，使之与 `Deployment` 匹配，<br/>重启 `Deployment` 成功后， 真实节点中匹配到的所有 `Pod` 的出口 IP 为 `eip`                                                                                                                                                                                                                                                                                | p3  | false |  |    |
| R00005 | 当关机 `eip` 生效的节点后，`eip` 会生效到另外匹配 `NodeSelector` 的节点上，<br/>并且 `egressGatewayStatus` 及 `EgressClusterStatus` 如预期更新，与被关机的节点对应的 `EgressTunnel` 将被删除，出口 IP 如预期访问                                                                                                                                                                                                                                                                                     | p3  | false | done |    |
| R00006 | 当关机 `egressGateway` 中 `NodeSelector` 匹配的所有节点后，<br/>`Pod` 的出口 IP 将由 `eip` 改为非 `eip`，`egressGatewayStatus.NodeList` 将为空，相关的 `EgressIgnoreCIDR.NodeIP` 将被删除，与被关机的节点对应的 `EgressTunnel` 将被删除。<br/> 将其中一个 `node` 开机后，`egressgateway` 会在短时间内恢复并记录恢复时间，并且 `eip` 重新生效为 `Pod` 的出口 IP，`EgressIgnoreCIDR.NodeIP` 将对应的 `nodeIP` 添加并且 `egressGatewayStatus.NodeList` 中 `node` 相关信息更新正确，<br/>全部开机最后 `eip` 只会生效在第一个恢复的 `node` 上，`EgressIgnoreCIDR.NodeIP` 更新正确 | p3  | false | done |    |
| R00007 | 依次重启集群中各个组件（包含 calico，kube-proxy）`Pod`， 重启过程中访问集群外部的出口 IP 为设置好的 `eip`，并且业务不能断流， 等待集群恢复正常后，`egressgateway` 组件的各个 `cr` 状态正确                                                                                                                                                                                                                                                                                                                      | p1  | false | done |    |
| R00008 | 创建 `egressGateway` 分配有 100 个 IP 的池，创建 120 个 policy，做多次删除和创建操作之后，期望 `egressGateway` 及 `Policy` 状态正确, `pod` 的出口 IP 符合预期                                                                                                                                                                                                                                                                                                                          | p1  | true  | done |    |